(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[641],{63:(e,t,r)=>{"use strict";var s=r(7260);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},1150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let s=r(5155),a=r(2115),l=r(4437);function i(e){return{default:e&&"default"in e?e.default:e}}r(6552);let n={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},o=function(e){let t={...n,...e},r=(0,a.lazy)(()=>t.loader().then(i)),o=t.loading;function d(e){let i=o?(0,s.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,n=!t.ssr||!!t.loading,d=n?a.Suspense:a.Fragment,c=t.ssr?(0,s.jsxs)(s.Fragment,{children:[null,(0,s.jsx)(r,{...e})]}):(0,s.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(r,{...e})});return(0,s.jsx)(d,{...n?{fallback:i}:{},children:c})}return d.displayName="LoadableComponent",d}},1155:(e,t,r)=>{"use strict";r.d(t,{mp:()=>s,qt:()=>a,xZ:()=>l});let s=[{id:"acuity-near",label:"Near Visual Acuity (Tumbling E)",category:"score",short:"Sharpness at 40 cm",needsCalibration:!0,needsDistance:!0},{id:"acuity-distance",label:"Distance Visual Acuity (Tumbling E)",category:"score",short:"Sharpness at 2–3 m",needsCalibration:!0,needsDistance:!0},{id:"contrast",label:"Contrast Sensitivity (letter threshold)",category:"score",short:"Low-contrast seeing",needsCalibration:!0,needsDistance:!0},{id:"color-arrangement",label:"Color Arrangement (Mini D‑15 style)",category:"score",short:"Color ordering error score"},{id:"reading-speed",label:"Reading Speed & Comfort",category:"score",short:"WPM + strain"},{id:"npc",label:"Near Point of Convergence (NPC)",category:"score",short:"Alignment endurance (cm)"},{id:"accommodation",label:"Accommodation Amplitude (Push‑Up)",category:"score",short:"Focusing power (D)"},{id:"glare",label:"Glare/Photophobia Threshold",category:"score",short:"With vs without glare"},{id:"amsler",label:"Amsler Grid (macular distortion)",category:"self",short:"Mark distortions"},{id:"astigmatism",label:"Astigmatism Dial (clock test)",category:"self",short:"Darker/thicker spokes angle"},{id:"duochrome",label:"Red‑Green Duochrome Balance",category:"self",short:"Focus bias after acuity"},{id:"eye-dominance",label:"Eye Dominance (Miles/Cardhole style)",category:"self",short:"Dominant eye"},{id:"visual-field",label:"Visual Field Screener (suprathreshold)",category:"self",short:"Peripheral hit-map"},{id:"pd-ruler",label:"PD Ruler (manual, calibrated)",category:"self",short:"Interpupillary distance"},{id:"stereopsis",label:"Stereopsis (Depth, Red‑Cyan)",category:"accessory",short:"Depth threshold (arcsec)",needsCalibration:!0,needsDistance:!0},{id:"worth-4-dot",label:"Worth 4‑Dot (Red‑Green)",category:"accessory",short:"Fusion / suppression"},{id:"osdi",label:"OSDI (Dry Eye Symptoms)",category:"self",short:"0–100 score (tracking)"},{id:"ciss",label:"CISS (Convergence Symptoms)",category:"self",short:"Raw score (tracking)"},{id:"cvs",label:"Computer Vision Syndrome / 20‑20‑20",category:"self",short:"Symptoms + habit"},{id:"night-vision",label:"Night/Low‑Light Difficulty",category:"self",short:"Checklist trend"}],a={ceil:"#6592E1",dark:"#001130"},l={radius:{md:"12px",lg:"16px"},motion:{fast:"200ms",base:"240ms"}}},1847:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(2115);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:u,...h}=e;return(0,s.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:o?24*Number(n)/Number(a):n,className:l("lucide",d),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(h)&&{"aria-hidden":"true"},...h},[...u.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),o=(e,t)=>{let r=(0,s.forwardRef)((r,i)=>{let{className:o,...d}=r;return(0,s.createElement)(n,{ref:i,iconNode:t,className:l("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...d})});return r.displayName=a(e),r}},1856:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var s=r(5155),a=r(2115),l=r(6278),i=r.n(l),n=r(1155);function o(e){let{steps:t,current:r,className:a}=e,l=Math.round((r+1)/t.length*100);return(0,s.jsxs)("div",{className:a,children:[(0,s.jsx)("div",{className:"flex items-center justify-between text-[11px] text-slate-300",children:t.map((e,t)=>(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("div",{className:"mb-1 font-medium "+(t===r?"text-slate-100":"text-slate-400"),children:e})},e))}),(0,s.jsx)("div",{className:"relative h-2 w-full overflow-hidden rounded-full bg-white/10","aria-label":"Progress",role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":l,children:(0,s.jsx)("div",{className:"absolute left-0 top-0 h-full bg-[#6592E1] transition-[width]",style:{width:"".concat(l,"%"),transitionDuration:n.xZ.motion.fast}})})]})}function d(e){let{variant:t,backLabel:r="Back",primaryLabel:a,onBack:l,onPrimary:i,extraAction:n}=e;return(0,s.jsx)("div",{role:"group","aria-label":"run"===t?"Test controls":"Flow navigation",className:"fixed inset-x-0 bottom-0 z-[60] border-t border-white/10 bg-[#041126]/95 backdrop-blur supports-[backdrop-filter]:bg-[#041126]/80",style:{paddingBottom:"calc(env(safe-area-inset-bottom))"},children:(0,s.jsxs)("div",{className:"mx-auto flex max-w-6xl items-center gap-2 px-4 py-3 sm:px-6 lg:px-8",children:[l?(0,s.jsx)("button",{onClick:l,className:"min-h-11 flex-1 rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm text-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#6592E1]",style:{minWidth:44,minHeight:44},children:r}):(0,s.jsx)("div",{className:"flex-1"}),n?(0,s.jsx)("button",{onClick:n.onClick,className:"min-h-11 rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm text-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#6592E1]",style:{minWidth:44,minHeight:44},children:n.label}):null,(0,s.jsx)("button",{onClick:i,className:"min-h-11 rounded-xl bg-[#6592E1] px-5 py-2 text-sm font-medium text-white transition hover:brightness-110 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-0 focus-visible:ring-[#6592E1]",style:{minWidth:44,minHeight:44},children:a})]})})}function c(e){let{pxPerMM:t,setPxPerMM:r,onDone:l}=e,[i,n]=(0,a.useState)("card"),[o,d]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=document.createElement("div");e.style.width="1in",e.style.position="absolute",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetWidth||96;document.body.removeChild(e);let r=t/25.4;Number.isFinite(r)&&d(r)},[]),(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:"Screen calibration"}),(0,s.jsx)("p",{className:"text-xs text-slate-300",children:"Choose a method. Aim for a precise match — size‑based tests depend on it."})]}),(0,s.jsxs)("div",{className:"text-xs text-slate-400",children:["Scale: ",(0,s.jsx)("b",{children:t?t.toFixed(2):"—"})," px/mm"," ",t?(0,s.jsx)("span",{className:"ml-2 rounded-full bg-emerald-500/15 px-2 py-0.5 text-[10px] text-emerald-200",children:"saved"}):null,!t&&o?(0,s.jsx)("button",{className:"ml-2 rounded-full bg-blue-500/15 px-2 py-0.5 text-[10px] text-blue-200 underline",onClick:()=>r(o),children:"Use estimate"}):null]})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,s.jsx)(u,{id:"card",title:"A) Credit/ID card (85.6 mm)",open:"card"===i,onToggle:()=>n("card"),children:(0,s.jsx)(h,{onSave:e=>r(e/85.6)})}),(0,s.jsx)(u,{id:"inch",title:"B) 1‑inch box (pinch/zoom)",open:"inch"===i,onToggle:()=>n("inch"),children:(0,s.jsx)(m,{onSave:e=>r(e/25.4)})}),(0,s.jsx)(u,{id:"coin",title:"C) Coin (choose + match diameter)",open:"coin"===i,onToggle:()=>n("coin"),children:(0,s.jsx)(x,{onSave:(e,t)=>r(e/t)})})]}),(0,s.jsx)("div",{className:"mt-3 flex justify-end",children:(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white disabled:opacity-60",onClick:l,disabled:!t,style:{minHeight:44,minWidth:44},children:"Continue"})})]})}function u(e){let{id:t,title:r,open:a,onToggle:l,children:i}=e;return(0,s.jsxs)("div",{className:"overflow-hidden rounded-xl border border-white/10 bg-white/5",children:[(0,s.jsxs)("button",{className:"flex w-full items-center justify-between px-3 py-3 text-left","aria-expanded":a,"aria-controls":"panel-".concat(t),onClick:l,children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:r}),(0,s.jsx)("span",{className:"text-xs text-slate-400",children:a?"Hide":"Show"})]}),(0,s.jsx)("div",{id:"panel-".concat(t),hidden:!a,className:"border-t border-white/10 p-3",children:i})]})}function h(e){let{onSave:t}=e,[r,l]=(0,a.useState)(300);return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mx-auto h-8 rounded-md border border-white/10 bg-white/10",style:{width:r},"aria-label":"Adjust to match your card width"}),(0,s.jsx)("input",{className:"mt-2 w-full",type:"range",min:100,max:700,step:1,value:r,onChange:e=>l(Number(e.target.value))}),(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{children:"Match this bar to your card width (85.6 mm)"}),(0,s.jsx)("button",{className:"rounded-full bg-[#6592E1] px-3 py-1 text-white",onClick:()=>t(r),children:"Save"})]})]})}function m(e){let{onSave:t}=e,r=(0,a.useRef)(null),[l,i]=(0,a.useState)(1);return(0,a.useEffect)(()=>{let e=r.current;if(!e)return;let t=0,s=1,a=e=>{2===e.touches.length&&(t=b(e.touches[0],e.touches[1]),s=l)},n=e=>{2===e.touches.length&&i(Math.min(3,Math.max(.3,b(e.touches[0],e.touches[1])/t*s)))};return e.addEventListener("touchstart",a,{passive:!0}),e.addEventListener("touchmove",n,{passive:!0}),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",n)}},[l]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{ref:r,className:"shrink-0 border border-dashed border-white/30",style:{width:"".concat(96*l,"px"),height:"".concat(96*l,"px")},"aria-label":"Pinch/zoom box to 1‑inch"}),(0,s.jsx)("div",{className:"text-xs text-slate-300",children:"Place a 1‑inch ruler/object over the box. Pinch/zoom (or use slider) to match exactly."})]}),(0,s.jsx)("input",{className:"mt-2 w-full",type:"range",min:.3,max:3,step:.01,value:l,onChange:e=>i(Number(e.target.value))}),(0,s.jsx)("div",{className:"mt-2 flex items-center justify-end",children:(0,s.jsx)("button",{className:"rounded-full bg-[#6592E1] px-3 py-1 text-white",onClick:()=>t(96*l),children:"Save scale"})})]})}function x(e){let{onSave:t}=e,[r,l]=(0,a.useState)(24.26),[i,n]=(0,a.useState)(100);return(0,s.jsxs)("div",{children:[(0,s.jsx)("select",{className:"w-full rounded-md border border-white/10 bg-white/5 p-2 text-sm",value:r,onChange:e=>l(Number(e.target.value)),children:[{label:"US quarter (24.26 mm)",mm:24.26},{label:"€1 coin (23.25 mm)",mm:23.25},{label:"₹10 coin (27.0 mm)",mm:27}].map(e=>(0,s.jsx)("option",{value:e.mm,children:e.label},e.label))}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"mx-auto h-8 rounded-md border border-white/10 bg-white/10",style:{width:i}}),(0,s.jsx)("input",{className:"mt-2 w-full",type:"range",min:60,max:180,step:1,value:i,onChange:e=>n(Number(e.target.value))})]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{children:"Match bar to coin diameter"}),(0,s.jsx)("button",{className:"rounded-full bg-[#6592E1] px-3 py-1 text-white",onClick:()=>t(i,r),children:"Save"})]})]})}function b(e,t){return Math.hypot(e.clientX-t.clientX,e.clientY-t.clientY)}function p(e){let{tests:t,activeId:r,onPick:a,search:l,onSearch:i,category:n,onCategoryChange:o}=e;return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"flex flex-wrap items-center gap-1",children:["all","score","self","accessory"].map(e=>(0,s.jsx)("button",{onClick:()=>o(e),className:"rounded-full px-3 py-1 text-xs transition "+(n===e?"bg-[#6592E1] text-white":"bg-white/10 text-slate-200"),style:{minHeight:32,minWidth:44},children:"all"===e?"All":"score"===e?"Score‑based":"self"===e?"Self/Notes":"Accessories"},e))}),(0,s.jsx)("label",{className:"sr-only",htmlFor:"searchTests",children:"Search tests"}),(0,s.jsx)("input",{id:"searchTests",placeholder:"Search tests…",className:"w-44 rounded-md border border-white/10 bg-white/5 px-3 py-2 text-sm",value:l,onChange:e=>i(e.target.value)})]}),(0,s.jsx)("ul",{className:"grid grid-cols-1 gap-3 lg:grid-cols-2",children:t.map(e=>(0,s.jsx)("li",{children:(0,s.jsx)("button",{className:"w-full rounded-2xl border p-4 text-left transition "+(r===e.id?"border-transparent bg-[#6592E1] text-white":"border-white/10 bg-white/5 hover:bg-white/10"),onClick:()=>a(e.id),"aria-pressed":r===e.id,style:{minHeight:84},children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:e.label}),e.short?(0,s.jsx)("div",{className:"mt-1 text-xs text-slate-300",children:e.short}):null]}),(0,s.jsx)("span",{className:"rounded-full border border-white/20 px-2 py-0.5 text-[10px] uppercase",children:"score"===e.category?"Score":"self"===e.category?"Self":"Accessories"})]})})},e.id))})]})}function g(e){let{results:t,onClear:r}=e,[l,i]=(0,a.useState)(""),[n,o]=(0,a.useState)("all"),[d,c]=(0,a.useState)("all"),[u,h]=(0,a.useState)("newest"),m=(0,a.useId)(),x=(0,a.useId)(),b=(0,a.useId)(),p=(0,a.useId)(),g=(0,a.useMemo)(()=>[...t.filter(e=>("all"===n||e.category===n)&&("all"===d||e.eye===d)&&(""===l||e.label.toLowerCase().includes(l.toLowerCase())))].sort((e,t)=>{switch(u){case"newest":return t.timestamp-e.timestamp;case"oldest":return e.timestamp-t.timestamp;case"label-asc":return e.label.localeCompare(t.label);case"label-desc":return t.label.localeCompare(e.label);default:return 0}}),[t,l,n,d,u]),f=async e=>{let t="".concat(e.label," — ").concat(e.value).concat(e.unit?" ".concat(e.unit):""," • Eye: ").concat(e.eye," • ").concat(new Date(e.timestamp).toLocaleString()).concat(e.distanceCm?" • ".concat(e.distanceCm," cm"):"").concat(e.notes?" • ".concat(e.notes):"");try{await navigator.clipboard.writeText(t);let e=document.createElement("div");e.textContent="Copied!",e.className="fixed bottom-5 left-1/2 -translate-x-1/2 rounded-full bg-black/80 px-3 py-1 text-xs text-white z-50",document.body.appendChild(e),setTimeout(()=>e.remove(),900)}catch(e){window.prompt("Copy summary:",t)}},v=()=>{i(""),o("all"),c("all"),h("newest")};return(0,s.jsxs)("div",{className:"rounded-2xl border border-v-dark/10 bg-white/50 p-4 shadow-soft backdrop-blur-md dark:bg-white/5 dark:border-white/10",children:[(0,s.jsxs)("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-v-dark dark:text-white",children:"Saved results"}),(0,s.jsxs)("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{htmlFor:m,className:"sr-only",children:"Search results"}),(0,s.jsx)("input",{id:m,className:"w-full rounded-md border border-v-dark/10 bg-white px-2 py-1 text-sm text-v-dark placeholder-v-dark/50 focus:outline-none focus:ring-2 focus:ring-v-ceil/60 dark:bg-white/5 dark:text-white dark:border-white/10",placeholder:"Search by label…",value:l,onChange:e=>i(e.target.value)})]}),(0,s.jsxs)("div",{className:"grid w-full grid-cols-2 gap-2 sm:w-auto sm:grid-cols-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{htmlFor:x,className:"sr-only",children:"Category"}),(0,s.jsxs)("select",{id:x,className:"w-full rounded-md border border-v-dark/10 bg-white px-2 py-1 text-sm text-v-dark focus:outline-none focus:ring-2 focus:ring-v-ceil/60 dark:bg-white/5 dark:text-white dark:border-white/10",value:n,onChange:e=>o(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All categories"}),(0,s.jsx)("option",{value:"score",children:"Score-based"}),(0,s.jsx)("option",{value:"self",children:"Self/Notes"}),(0,s.jsx)("option",{value:"accessory",children:"Accessories"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{htmlFor:b,className:"sr-only",children:"Eye"}),(0,s.jsxs)("select",{id:b,className:"w-full rounded-md border border-v-dark/10 bg-white px-2 py-1 text-sm text-v-dark focus:outline-none focus:ring-2 focus:ring-v-ceil/60 dark:bg-white/5 dark:text-white dark:border-white/10",value:d,onChange:e=>c(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All eyes"}),(0,s.jsx)("option",{value:"OD",children:"OD"}),(0,s.jsx)("option",{value:"OS",children:"OS"}),(0,s.jsx)("option",{value:"OU",children:"OU"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{htmlFor:p,className:"sr-only",children:"Sort"}),(0,s.jsxs)("select",{id:p,className:"w-full rounded-md border border-v-dark/10 bg-white px-2 py-1 text-sm text-v-dark focus:outline-none focus:ring-2 focus:ring-v-ceil/60 dark:bg-white/5 dark:text-white dark:border-white/10",value:u,onChange:e=>h(e.target.value),children:[(0,s.jsx)("option",{value:"newest",children:"Newest first"}),(0,s.jsx)("option",{value:"oldest",children:"Oldest first"}),(0,s.jsx)("option",{value:"label-asc",children:"Label A→Z"}),(0,s.jsx)("option",{value:"label-desc",children:"Label Z→A"})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("button",{className:"rounded-md border border-v-dark/10 bg-white px-3 py-1 text-sm shadow-sm hover:-translate-y-0.5 hover:shadow transition dark:bg-white/5 dark:text-white dark:border-white/10",onClick:()=>{if(!g.length)return;let e=new Blob([[["date","label","category","eye","value","unit","notes","distanceCm"],...g.map(e=>{var t,r,s;return[new Date(e.timestamp).toISOString(),e.label,e.category,e.eye,e.value,null!=(t=e.unit)?t:"",null!=(r=e.notes)?r:"",null!=(s=e.distanceCm)?s:""]})].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t;let s=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");r.download="visionary_results_".concat(s,".csv"),document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(t)},disabled:!g.length,title:g.length?"Export filtered results to CSV":"No results to export",children:"Export CSV"}),(0,s.jsx)("button",{className:"rounded-md border border-v-dark/10 bg-white px-3 py-1 text-sm shadow-sm hover:-translate-y-0.5 hover:shadow transition dark:bg-white/5 dark:text-white dark:border-white/10",onClick:()=>{window.print()},title:"Open print dialog; choose “Save as PDF” to share",children:"Print / Save PDF"}),t.length>0&&(0,s.jsx)("button",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-1 text-sm text-red-700 shadow-sm hover:-translate-y-0.5 hover:shadow transition dark:bg-red-500/10 dark:text-red-300 dark:border-red-400/20",onClick:r,title:"Remove all saved results",children:"Clear all"}),(0,s.jsx)("button",{className:"rounded-md border border-v-dark/10 bg-white px-3 py-1 text-sm shadow-sm hover:-translate-y-0.5 hover:shadow transition dark:bg-white/5 dark:text-white dark:border-white/10",onClick:v,title:"Reset all filters",children:"Reset filters"})]})]})]}),g.length?(0,s.jsx)("ul",{className:"grid grid-cols-1 gap-2",children:g.map((e,t)=>(0,s.jsxs)("li",{className:"group rounded-xl border border-v-dark/10 bg-white p-3 shadow-sm transition hover:-translate-y-0.5 hover:shadow dark:bg-[#0b1a33] dark:border-white/10",children:[(0,s.jsxs)("div",{className:"flex flex-col justify-between gap-2 sm:flex-row sm:items-center",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-v-dark dark:text-white",children:e.label}),(0,s.jsx)("span",{className:"rounded-full border border-v-dark/15 bg-v-ceil/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-v-dark/80 dark:border-white/10 dark:bg-v-ceil/20 dark:text-white/90",children:e.category}),(0,s.jsxs)("span",{className:"text-sm text-v-dark/90 dark:text-white/90",children:[e.value,e.unit?" ".concat(e.unit):""]}),e.notes?(0,s.jsx)("span",{className:"max-w-[28ch] truncate text-xs text-v-dark/60 dark:text-white/60",title:e.notes,children:e.notes}):null,(0,s.jsx)("span",{className:"rounded border border-v-dark/10 px-2 text-[10px] uppercase text-v-dark/80 dark:text-white/80 dark:border-white/10",children:e.eye})]}),(0,s.jsxs)("div",{className:"text-xs text-v-dark/60 dark:text-white/60",children:[new Date(e.timestamp).toLocaleString(),e.distanceCm?" \xb7 ".concat(e.distanceCm," cm"):""]})]}),(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:(0,s.jsx)("button",{className:"rounded-md border border-v-dark/10 bg-white px-3 py-1 shadow-sm transition hover:-translate-y-0.5 hover:shadow dark:bg-white/5 dark:text-white dark:border-white/10",onClick:()=>f(e),title:"Copy a one-line summary to clipboard",children:"Copy summary"})})]},"".concat(e.timestamp,"-").concat(e.label,"-").concat(t)))}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 rounded-xl border border-dashed border-v-dark/10 bg-white/40 p-6 text-center text-sm text-v-dark/70 dark:bg-white/5 dark:text-white/70 dark:border-white/10",children:[(0,s.jsx)("div",{className:"text-2xl",children:"\uD83D\uDDC2️"}),(0,s.jsx)("p",{children:0===t.length?"No results yet. Take a test and they will appear here.":"No results match your filters."}),t.length>0&&(0,s.jsx)("button",{className:"mt-1 rounded-md border border-v-dark/10 bg-white px-3 py-1 text-xs shadow-sm hover:-translate-y-0.5 hover:shadow transition dark:bg-white/5 dark:text-white dark:border-white/10",onClick:v,children:"Clear filters"})]})]})}function f(e,t){let[r,s]=(0,a.useState)(()=>{let r=sessionStorage.getItem(e);if(r)return JSON.parse(r);let s=localStorage.getItem(e);return s?JSON.parse(s):t});return(0,a.useEffect)(()=>{try{sessionStorage.setItem(e,JSON.stringify(r)),localStorage.removeItem(e)}catch(e){}},[e,r]),[r,s]}var v=r(63),w=r(5626);let y=function(e){let{className:t="",onClick:r,label:a="Back",disabled:l=!1}=e,i=(0,v.useRouter)();return(0,s.jsxs)("button",{type:"button",onClick:()=>{if(!l){if(r)return r();i.back()}},className:"".concat("inline-flex items-center gap-2 rounded-xl px-3 py-2 text-sm ring-1 ring-white/15 text-white/85 hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#6592E1] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-transparent"," ").concat(t),"aria-label":a,"aria-disabled":l||void 0,disabled:l,children:[(0,s.jsx)(w.A,{className:"h-4 w-4","aria-hidden":"true"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:a})]})};var j=r(7937);let k=i()(()=>r.e(386).then(r.bind(r,386)),{loadableGenerated:{webpack:()=>[386]},ssr:!1}),N="relative overflow-visible rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm shadow-soft";var C=function(e){return e[e.Calibration=0]="Calibration",e[e.Select=1]="Select",e[e.Run=2]="Run",e[e.Results=3]="Results",e}(C||{});function S(){var e;let[t,r]=f("visionary:pxPerMM",null),[l]=f("visionary:distanceCm",40),[i]=f("visionary:eye","OU"),[u,h]=f("visionary:results",[]),[m,x]=(0,a.useState)("acuity-near"),b=+!!t,[v,w]=(0,a.useState)(b);(0,a.useEffect)(()=>{t||w(0)},[t]);let[C,S]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=()=>S(window.scrollY>8);return e(),window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]);let[E,P]=(0,a.useState)("all"),[A,D]=(0,a.useState)(""),[O,L]=(0,a.useState)(!1),_=n.mp.find(e=>e.id===m),R=(0,a.useMemo)(()=>n.mp.filter(e=>("all"===E||e.category===E)&&(""===A.trim()||e.label.toLowerCase().includes(A.toLowerCase()))),[E,A]),M=(0,a.useCallback)(()=>{w(e=>3===e?1:e>0?e-1:e)},[]),T=(0,a.useCallback)(()=>0===v?w(1):1===v&&_?w(2):2===v?w(3):3===v?w(1):void 0,[v,_]);(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&0!==v?(e.preventDefault(),M()):"Enter"===e.key&&2!==v&&T()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[v,M,T]);let I=["Calibration","Select Test","Run Test","Results"];return(0,s.jsxs)("main",{className:" min-h-[100svh] w-full text-slate-100 pb-[calc(env(safe-area-inset-bottom)+84px)] bg-[radial-gradient(1200px_600px_at_50%_-200px,rgba(101,146,225,0.25),transparent),#000914] ",children:[(0,s.jsx)("header",{className:"sticky top-0 z-30 border-b border-white/5 backdrop-blur "+(C?"bg-[#0b1324]/65":"bg-transparent"),role:"banner","aria-label":"Tests header",children:(0,s.jsxs)("div",{className:"mx-auto max-w-6xl px-4 pt-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(y,{onClick:M,disabled:0===v,className:"rounded-xl px-3 py-2 text-sm text-white/85 ring-1 ring-white/15 hover:bg-white/10",label:3===v?"Go back to tests":"Back"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h1",{className:"font-manrope font-extrabold tracking-tight text-2xl md:text-[28px] leading-tight",children:"Tests"}),(0,s.jsx)(j.A,{className:"hidden sm:block h-4 w-4 text-white/40","aria-hidden":!0}),(0,s.jsxs)("span",{className:"hidden sm:block text-sm text-white/70",children:["Step ",v+1," of ",I.length,": ",I[v]]})]}),!C&&(0,s.jsx)("p",{className:"mt-1 text-sm text-slate-300",children:"Quick, guided screening. You can pause any time and review results after."})]})]}),(0,s.jsxs)("div",{className:"hidden sm:inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-xs ring-1 "+(t?"bg-emerald-400/10 text-emerald-200 ring-emerald-300/30":"bg-amber-400/10 text-amber-200 ring-amber-300/30"),"aria-live":"polite",children:[(0,s.jsx)("span",{className:"inline-block h-2 w-2 rounded-full "+(t?"bg-emerald-400":"bg-amber-400"),"aria-hidden":!0}),t?"Calibrated":"Calibration needed"]})]}),(0,s.jsx)(o,{steps:I,current:v,className:"mt-4"})]})}),(0,s.jsxs)("div",{className:"sr-only","aria-live":"polite",children:["Step changed to ",I[v]]}),(0,s.jsxs)("section",{role:"region","aria-label":I[v],className:"mx-auto max-w-6xl px-4 py-6 sm:px-6 lg:px-8",children:[0===v&&(0,s.jsxs)("div",{className:"".concat(N," p-4 md:p-5"),children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-x-0 -top-px h-[2px] rounded-t-2xl bg-gradient-to-r from-[#6592E1]/70 via-transparent to-[#81B1E6]/70"}),(0,s.jsx)(c,{pxPerMM:t,setPxPerMM:r,onDone:()=>w(1)})]}),1===v&&(0,s.jsxs)("div",{className:"".concat(N," p-4 md:p-5 z-10"),children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-x-0 -top-px h-[2px] rounded-t-2xl bg-gradient-to-r from-[#6592E1]/70 via-transparent to-[#81B1E6]/70"}),(0,s.jsx)("div",{className:"relative z-20",children:(0,s.jsx)(p,{tests:R,activeId:m,onPick:e=>{x(e),w(2),L(!1)},search:A,onSearch:D,category:E,onCategoryChange:P})}),(0,s.jsxs)("p",{className:"mt-4 text-xs text-slate-400",children:["Defaults: ",(0,s.jsxs)("b",{children:[l," cm"]}),", ",(0,s.jsx)("b",{children:i}),". (Adjust inside tests where available.)"]})]}),2===v&&(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"grid place-items-center py-16 text-slate-300",children:"Loading test…"}),children:(0,s.jsx)("div",{className:"relative z-10 min-h-[360px]",children:(0,s.jsx)(k,{id:m,pxPerMM:t,distanceCm:l,eye:i,onResult:e=>{let t=n.mp.find(t=>t.id===e.id);h(r=>[{...e,label:t.label,category:t.category,eye:i,distanceCm:l,timestamp:Date.now()},...r]),L(!1),w(3)},paused:O})})}),3===v&&(0,s.jsxs)("div",{className:"".concat(N," p-4 md:p-5 z-10"),children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-x-0 -top-px h-[2px] rounded-t-2xl bg-gradient-to-r from-[#6592E1]/70 via-transparent to-[#81B1E6]/70"}),(0,s.jsx)(g,{results:u,onClear:()=>h([])})]})]}),(0,s.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-40 ring-1 ring-white/10 backdrop-blur supports-[backdrop-filter]:bg-[#0b1324]/70",children:(0,s.jsx)(d,{variant:2===v?"run":"setup",backLabel:0===v?void 0:3===v?"Go back to tests":"Back",primaryLabel:2===v?O?"Resume":"Pause":3===v?"New Test":"Continue",onBack:0===v?void 0:M,onPrimary:()=>{2===v?L(e=>!e):3===v?w(1):T()},extraAction:2===v&&(null==_||null==(e=_.id)?void 0:e.includes("acuity"))?{label:"Save Result",onClick:()=>{window.dispatchEvent(new CustomEvent("visionary:save-active-test"))}}:void 0})})]})}},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{bindSnapshot:function(){return i},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return n}});let r=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class s{disable(){throw r}getStore(){}run(){throw r}exit(){throw r}enterWith(){throw r}static bind(e){return e}}let a="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return a?new a:new s}function i(e){return a?a.bind(e):s.bind(e)}function n(){return a?a.snapshot():function(e,...t){return e(...t)}}},4107:(e,t,r)=>{Promise.resolve().then(r.bind(r,1856))},4437:(e,t,r)=>{"use strict";function s(e){let{reason:t,children:r}=e;return r}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}}),r(4553)},5626:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(1847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6278:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let s=r(8140)._(r(1150));function a(e,t){var r;let a={};"function"==typeof e&&(a.loader=e);let l={...a,...t};return(0,s.default)({...l,modules:null==(r=l.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6552:(e,t,r)=>{"use strict";function s(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return s}}),r(5155),r(7650),r(8567),r(7278)},7828:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return s}});let s=(0,r(4054).createAsyncLocalStorage)()},7937:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(1847).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},8567:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return s.workAsyncStorageInstance}});let s=r(7828)}},e=>{e.O(0,[441,255,358],()=>e(e.s=4107)),_N_E=e.O()}]);