(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[875],{2149:(e,t,s)=>{Promise.resolve().then(s.bind(s,9022))},9022:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var i=s(5155),n=s(2115),a=s(2619),r=s.n(a),l=s(9776),o=s(2454),d=s(549),c=s(1508);let u=c.Ikc({enabled:c.zMY(),hour:c.aig().min(0).max(23),minute:c.aig().min(0).max(59),days:c.YOg(c.aig().int().min(0).max(6)),everyDay:c.zMY(),tz:c.YjP(),lastCheckedAt:c.aig().optional()}),m="visionary:sleep-reminder",h=()=>({enabled:!1,hour:22,minute:0,days:[0,1,2,3,4,5,6],everyDay:!0,tz:"undefined"!=typeof Intl?Intl.DateTimeFormat().resolvedOptions().timeZone:"UTC",lastCheckedAt:Date.now()});async function x(e){let t=u.parse(e);localStorage.setItem(m,JSON.stringify(t))}let f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],b=[1,2,3,4,5,6,0],g=e=>f[(e%7+7)%7];function p(e,t){try{return new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"2-digit",timeZone:t}).format(e)}catch(i){let t=e.getHours(),s=String(e.getMinutes()).padStart(2,"0");return"".concat((t+11)%12+1,":").concat(s," ").concat(t<12?"AM":"PM")}}function y(e,t,s){let i=new Date;return i.setHours(e,t,0,0),p(i,s)}function w(e){return e.everyDay?[0,1,2,3,4,5,6]:Array.from(new Set(e.days)).sort((e,t)=>e-t)}function v(e,t){if(!e.enabled)return null;let s=w(e);if(0===s.length)return null;let i=t.getDay(),n=new Date(t),a=null;for(let r of s){let s=(r-i+7)%7,l=new Date(n);l.setHours(e.hour,e.minute,0,0),l.setDate(n.getDate()+s),0===s&&l<=t&&l.setDate(l.getDate()+7),(!a||l<a)&&(a=l)}return a}function N(e,t,s){if(!e.enabled)return[];let i=0,n={...e,enabled:!0},a=[],r=new Date(t.getTime());for(r.setSeconds(r.getSeconds()-1);i<30;){let e=v(n,r);if(!e||e>s)break;e>t&&e<=s&&a.push(e),r=new Date(e.getTime()+1e3),i++}return a}let j=["sleep-reminder-settings"],k=(0,n.createContext)(null);function D(e){let{children:t}=e,[s,a]=(0,n.useState)([]),r=(0,n.useCallback)((e,t)=>{let s=Date.now()+Math.random();a(i=>[...i,{id:s,kind:e,message:t}]),setTimeout(()=>{a(e=>e.filter(e=>e.id!==s))},3500)},[]),l=(0,n.useMemo)(()=>({push:r}),[r]);return(0,i.jsxs)(k.Provider,{value:l,children:[t,(0,i.jsx)("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-[1000] flex w-full justify-center px-4",children:(0,i.jsx)("div",{className:"flex w-full max-w-md flex-col gap-2",children:s.map(e=>(0,i.jsx)("div",{role:"status",className:"pointer-events-auto rounded-xl px-4 py-3 text-sm shadow-lg ring-1 ring-white/10\n                ".concat("success"===e.kind?"bg-emerald-500/15 text-emerald-100":"error"===e.kind?"bg-red-500/15 text-red-100":"bg-white/10 text-white","\n              "),children:e.message},e.id))})})]})}function S(){let{draft:e,setDraft:t,permission:s,requestPermission:a,save:r,enabled:c,setEnabled:f,lastMissedAt:D,openNotificationSettings:S,validation:C}=function(){var e;let t=(0,l.jE)(),{data:s}=(0,o.I)({queryKey:j,queryFn:async()=>(function(){let e=function(e,t){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}(localStorage.getItem(m),null),t=u.safeParse(e);if(t.success){var s;return{...h(),...t.data,days:t.data.everyDay?[0,1,2,3,4,5,6]:t.data.days,lastCheckedAt:null!=(s=t.data.lastCheckedAt)?s:Date.now()}}let i=h();return x(i),i})(),initialData:h(),staleTime:1/0,gcTime:1/0,enabled:!0}),[i,a]=(0,n.useState)(s);(0,n.useEffect)(()=>a(s),[s]);let r=i.enabled,c=i.everyDay||i.days.length>0?"ok":"no-days",[f,b]=(0,n.useState)(null),g=(0,n.useRef)(null),y=(0,n.useRef)(s),w=(0,n.useRef)(null!=(e=s.lastCheckedAt)?e:Date.now());(0,n.useEffect)(()=>{y.current=s},[s]);let k="Notification"in window?Notification.permission:"default",D=async()=>{if(!("Notification"in window))return"denied";try{return await Notification.requestPermission()}catch(e){return"denied"}},S=async e=>{let t="\uD83C\uDF19 Bedtime Reminder",s={body:null!=e?e:"Time to rest your eyes. Consistent sleep supports healthy vision.",tag:"visionary-bedtime-reminder",badge:"/icons/moon.svg",icon:"/icons/moon.svg",silent:!1};try{if("serviceWorker"in navigator){let e=await navigator.serviceWorker.ready;if("granted"===Notification.permission&&(null==e?void 0:e.showNotification))return void await e.showNotification(t,s)}}catch(e){}"Notification"in window&&"granted"===Notification.permission&&new Notification(t,s)},C=async e=>{var s,i;g.current&&(clearInterval(g.current),g.current=null),(e=(e=>{let t="undefined"!=typeof Intl?Intl.DateTimeFormat().resolvedOptions().timeZone:e.tz;return t&&t!==e.tz?{...e,tz:t}:e})(e)).tz!==y.current.tz&&(await x(e),t.setQueryData(j,e));let n=Date.now();if(w.current=Math.max(null!=(s=e.lastCheckedAt)?s:0,n),!e.enabled)return;let a=N(e,new Date((null!=(i=e.lastCheckedAt)?i:n)+1),new Date(n));if(a.length>0){let t=a[a.length-1];b(t),await S("You had a bedtime reminder at ".concat(p(t,e.tz),"."))}let r={...e,lastCheckedAt:n};await x(r),t.setQueryData(j,r),y.current=r,w.current=n,g.current=setInterval(async()=>{let e=y.current;if(!e.enabled)return;let s=w.current,i=Date.now(),n=N(e,new Date(s+1),new Date(i));if(n.length>0)for(let e of n)await S();w.current=i;let a={...e,lastCheckedAt:i};await x(a),t.setQueryData(j,a),y.current=a},3e4)},A=(0,d.n)({mutationFn:async e=>(await x(e),e),onSuccess:async e=>{t.setQueryData(j,e),await C(e)}});(0,n.useEffect)(()=>(C(s),()=>{g.current&&clearInterval(g.current)}),[]),(0,n.useEffect)(()=>{let e=async()=>{"visible"===document.visibilityState&&await C(y.current)};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]);let T=async()=>{var e;if(i.enabled&&"granted"!==await D())return a(e=>({...e,enabled:!1})),{ok:!1,error:"permission-denied"};if(!i.everyDay&&0===i.days.length)return{ok:!1,error:"no-days"};let t={...i,days:i.everyDay?[0,1,2,3,4,5,6]:Array.from(new Set(i.days)).sort((e,t)=>e-t),tz:Intl.DateTimeFormat().resolvedOptions().timeZone||i.tz,lastCheckedAt:null!=(e=y.current.lastCheckedAt)?e:Date.now()};try{return await A.mutateAsync(t),{ok:!0}}catch(e){return{ok:!1,error:"unknown"}}};return{draft:i,setDraft:a,enabled:r,setEnabled:e=>{a(t=>({...t,enabled:e}))},permission:k,requestPermission:D,previewText:(0,n.useMemo)(()=>(function(e){if(!e.enabled)return"Off";let t=v(e,new Date),s=t?p(t,e.tz):"—",i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=e.everyDay?"Every day":e.days.slice().sort((e,t)=>e-t).map(e=>{var t;return null!=(t=i[e])?t:""}).join(", ");return"".concat(n," \xb7 ").concat(s)})(i),[i]),save:T,lastMissedAt:f,openNotificationSettings:()=>{let e=navigator.userAgent.toLowerCase(),t=[];if(e.includes("edg/")&&t.push("edge://settings/content/notifications"),(e.includes("chrome")||e.includes("crios")||e.includes("brave"))&&t.push("chrome://settings/content/notifications","brave://settings/content/notifications"),e.includes("firefox")&&t.push("about:preferences#privacy"),(e.includes("opr/")||e.includes("opera"))&&t.push("opera://settings/content/notifications"),e.includes("safari")&&!e.includes("chrome"))return void alert("On Safari: Settings → Websites → Notifications → Allow for this site.");for(let e of t)if(window.open(e,"_blank"))return;alert("Open your browser settings and allow notifications for this site.")},validation:c}}(),A=function(){let e=(0,n.useContext)(k);if(!e)throw Error("useToast must be used within ToastProvider");return{success:t=>e.push("success",t),error:t=>e.push("error",t),info:t=>e.push("info",t)}}(),[T,E]=(0,n.useState)(!1),z=(0,n.useMemo)(()=>{let t=String(e.hour).padStart(2,"0"),s=String(e.minute).padStart(2,"0");return"".concat(t,":").concat(s)},[e.hour,e.minute]),O=(0,n.useMemo)(()=>(function(e){let t=y(e.hour,e.minute,e.tz);if(e.everyDay)return"Reminds at ".concat(t," — Every day");let s=w(e);if(0===s.length)return"Reminds at ".concat(t," — (no days selected)");let i=b.filter(e=>s.includes(e)).map(e=>g(e));return"Reminds at ".concat(t," on ").concat(i.join(", "))})(e),[e]),I=async()=>{(c||"granted"===await a())&&f(!c)},M=async()=>{E(!0);let e=await r();E(!1),e.ok?A.success("Bedtime reminder saved."):"permission-denied"===e.error?A.error("Notifications are blocked by your browser."):"no-days"===e.error?A.error("Please pick at least one day or enable “Every day”."):A.error("Could not save. Please try again.")};return(0,i.jsxs)("section",{"aria-labelledby":"bedtime-reminder-heading",className:"rounded-2xl shadow-xl shadow-black/30 ring-1 ring-white/10 overflow-hidden",style:{backgroundColor:"#0A1C3A"},children:[(0,i.jsx)("div",{className:"h-2 w-full",style:{backgroundImage:"linear-gradient(90deg, ".concat("#6592E1"," 0%, ").concat("#81B1E6"," 100%)")}}),(0,i.jsxs)("div",{className:"p-5 sm:p-6",children:[(0,i.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h2",{id:"bedtime-reminder-heading",className:"font-[700] tracking-tight text-lg sm:text-xl",style:{fontFamily:"Manrope, Inter, ui-sans-serif, system-ui"},children:[(0,i.jsx)("span",{role:"img","aria-label":"moon",children:"\uD83C\uDF19"})," Bedtime Reminder"]}),(0,i.jsx)("p",{className:"mt-1 text-sm text-white/80",children:"Good sleep helps your eyes recover."})]}),(0,i.jsx)("button",{type:"button",role:"switch","aria-checked":c,"aria-label":c?"Turn bedtime reminder off":"Turn bedtime reminder on",onClick:I,className:"relative inline-flex h-9 w-16 shrink-0 cursor-pointer items-center rounded-full transition\n              ".concat(c?"bg-white/90":"bg-white/20","\n              focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-white/60 focus-visible:ring-offset-[#0A1C3A]\n              motion-reduce:transition-none"),children:(0,i.jsx)("span",{"aria-hidden":"true",className:"inline-block h-7 w-7 transform rounded-full bg-[#001130] shadow\n                transition translate-x-1 ".concat(c?"translate-x-8":"translate-x-1"," motion-reduce:transition-none")})})]}),"denied"===s&&(0,i.jsxs)("div",{className:"mt-4 rounded-xl border border-red-400/30 bg-red-500/10 p-3 text-sm text-red-200",children:["Notifications are blocked in your browser. Enable them to receive reminders."," ",(0,i.jsx)("button",{onClick:S,className:"underline decoration-red-300 underline-offset-2 hover:text-red-100",children:"Open Notification Settings"})]}),D&&(0,i.jsxs)("div",{className:"mt-4 rounded-xl border border-white/10 bg-white/5 p-3 text-sm text-white/90",children:["You had a bedtime reminder at"," ",(0,i.jsx)("strong",{children:y(D.getHours(),D.getMinutes())}),"."]}),(0,i.jsxs)("fieldset",{className:"mt-6 space-y-6",disabled:!c,children:[(0,i.jsxs)("div",{className:c?"opacity-100":"opacity-50",children:[(0,i.jsx)("label",{htmlFor:"sleep-time",className:"block text-sm text-white/90",children:"Time"}),(0,i.jsx)("input",{id:"sleep-time",type:"time",step:60,className:"mt-2 w-full rounded-xl border-0 bg-white/10 px-4 py-3 text-base text-white shadow-inner placeholder:text-white/60 focus:outline-none focus:ring-2 focus:ring-white/70 disabled:cursor-not-allowed",value:z,onChange:e=>{let[s,i]=e.target.value.split(":").map(Number);Number.isFinite(s)&&Number.isFinite(i)&&t(e=>({...e,hour:s,minute:i}))}}),(0,i.jsx)("p",{className:"mt-1 text-xs text-white/60",children:c?"Will remind at ".concat(y(e.hour,e.minute),"."):"Reminders are off."})]}),(0,i.jsxs)("div",{className:c?"opacity-100":"opacity-50",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("label",{className:"block text-sm text-white/90",children:"Days"}),(0,i.jsx)("button",{type:"button",onClick:()=>{t(e=>e.everyDay?{...e,everyDay:!1,days:[1,2,3,4,5]}:{...e,everyDay:!0,days:[0,1,2,3,4,5,6]})},className:"text-sm underline decoration-white/40 underline-offset-4 hover:text-white/90 disabled:cursor-not-allowed",disabled:!c,children:e.everyDay?"Customize days":"Every day"})]}),(0,i.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:b.map(s=>{let n=e.everyDay||e.days.includes(s);return(0,i.jsx)("button",{type:"button","aria-pressed":n,disabled:e.everyDay||!c,onClick:()=>{t(e=>{if(e.everyDay)return e;let t=e.days.includes(s)?e.days.filter(e=>e!==s):[...e.days,s].sort((e,t)=>e-t);return{...e,days:t}})},className:"h-11 min-w-[3.25rem] rounded-xl px-3 text-sm font-medium\n                      focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60\n                      ".concat(n?"bg-white text-[#001130]":"bg-white/10 text-white","\n                      ").concat(e.everyDay||!c?"opacity-50":"hover:bg-white/20","\n                      motion-reduce:transition-none"),children:g(s).slice(0,3)},s)})}),!e.everyDay&&0===e.days.length&&(0,i.jsx)("p",{className:"mt-2 text-xs text-red-200",children:"Pick at least one day or switch to “Every day”."}),(0,i.jsx)("p",{className:"mt-3 text-sm text-white/80",children:c?O:"—"})]})]}),(0,i.jsxs)("div",{className:"mt-6",children:[(0,i.jsx)("button",{type:"button",onClick:M,disabled:T||c&&"denied"===s||"no-days"===C,className:"inline-flex w-full items-center justify-center rounded-xl bg-white px-5 py-3 text-[#001130] shadow \n              hover:bg-white/90 active:bg-white/80 disabled:cursor-not-allowed disabled:opacity-60\n              focus:outline-none focus-visible:ring-2 focus-visible:ring-white/70 motion-reduce:transition-none",children:T?"Saving…":"Save"}),(0,i.jsxs)("p",{className:"mt-2 text-xs text-white/60",children:["Notifications title: ",(0,i.jsx)("em",{children:"“\uD83C\uDF19 Bedtime Reminder”"})," • Body: ",(0,i.jsx)("em",{children:"“Time to rest your eyes. Consistent sleep supports healthy vision.”"})]})]})]})]})}var C=s(7494),A=s(4157),T=s(455),E=s(4323),z=s(9427),O=s(5998);function I(e,t){try{var s;return null!=(s=localStorage.getItem(e))?s:t}catch(e){return t}}function M(){let e=I("sleep:bedtime","22:30"),t=I("sleep:wake","06:30"),s="true"===I("sleep:dnd","false"),n="rounded-2xl border border-white/10 bg-white/5 shadow-soft h-full";return(0,i.jsx)(D,{children:(0,i.jsxs)("main",{className:" min-h-[100dvh] text-white antialiased bg-[radial-gradient(1200px_600px_at_50%_-200px,rgba(101,146,225,0.20),transparent),#001130] ",children:[(0,i.jsx)("header",{className:"sticky top-0 z-10 border-b border-white/10 backdrop-blur bg-[#001130]/70",role:"banner",children:(0,i.jsx)("div",{className:"mx-auto max-w-6xl px-4 py-5 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("span",{className:"grid h-10 w-10 place-items-center rounded-xl",style:{backgroundColor:"rgba(101,146,225,0.15)"},"aria-hidden":!0,children:(0,i.jsx)(C.A,{className:"h-5 w-5 text-white/90"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"font-manrope text-2xl md:text-3xl font-extrabold leading-tight",children:"Sleep"}),(0,i.jsx)("p",{className:"mt-0.5 text-sm text-white/70",children:"Build a gentle wind-down and wake up refreshed."})]})]})})}),(0,i.jsx)("section",{className:"mx-auto max-w-6xl px-4 py-6 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,i.jsxs)("section",{className:"".concat(n," p-0 lg:min-h-[320px]"),"aria-labelledby":"reminders-title",children:[(0,i.jsx)("h2",{id:"reminders-title",className:"sr-only",children:"Reminders"}),(0,i.jsx)(S,{})]}),(0,i.jsxs)("section",{className:"".concat(n," p-5 lg:min-h-[320px]"),"aria-labelledby":"quick-title",children:[(0,i.jsx)("h2",{id:"quick-title",className:"font-manrope text-lg md:text-xl font-semibold",children:"Quick actions"}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-3",children:[(0,i.jsxs)(r(),{href:"/exercises?category=Relaxation",className:"group flex items-center justify-between rounded-xl border border-white/10 bg-[#0b1a33] p-4 motion-safe:transition shadow-sm hover:shadow-md focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-[rgba(101,146,225,0.35)]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(A.A,{className:"h-5 w-5 text-white/85","aria-hidden":!0}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium",children:"Breathing session"}),(0,i.jsx)("p",{className:"text-xs text-white/70",children:"3–5 minutes to wind down"})]})]}),(0,i.jsx)("span",{className:"text-xs text-white/60",children:"Open"})]}),(0,i.jsxs)(r(),{href:"/tests?category=Sleep",className:"group flex items-center justify-between rounded-xl border border-white/10 bg-[#0b1a33] p-4 motion-safe:transition shadow-sm hover:shadow-md focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-[rgba(101,146,225,0.35)]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(T.A,{className:"h-5 w-5 text-white/85","aria-hidden":!0}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium",children:"Sleepiness check"}),(0,i.jsx)("p",{className:"text-xs text-white/70",children:"Gauge daytime alertness"})]})]}),(0,i.jsx)("span",{className:"text-xs text-white/60",children:"Open"})]}),(0,i.jsxs)(r(),{href:"/blog?tag=sleep",className:"group flex items-center justify-between rounded-xl border border-white/10 bg-[#0b1a33] p-4 motion-safe:transition shadow-sm hover:shadow-md focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-[rgba(101,146,225,0.35)]",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(E.A,{className:"h-5 w-5 text-white/85","aria-hidden":!0}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium",children:"Read sleep tips"}),(0,i.jsx)("p",{className:"text-xs text-white/70",children:"Short guides and routines"})]})]}),(0,i.jsx)("span",{className:"text-xs text-white/60",children:"Open"})]})]})]}),(0,i.jsxs)("section",{className:"".concat(n," p-5 lg:col-span-2"),"aria-labelledby":"status-title",children:[(0,i.jsx)("h2",{id:"status-title",className:"font-manrope text-lg md:text-xl font-semibold",children:"Tonight at a glance"}),(0,i.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-3",children:[(0,i.jsxs)("div",{className:"rounded-xl border border-white/10 bg-[#0b1a33] p-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-white/80 text-sm",children:[(0,i.jsx)(T.A,{className:"h-4 w-4","aria-hidden":!0}),"Bedtime"]}),(0,i.jsx)("p",{className:"mt-1 text-lg font-semibold",children:e})]}),(0,i.jsxs)("div",{className:"rounded-xl border border-white/10 bg-[#0b1a33] p-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-white/80 text-sm",children:[(0,i.jsx)(z.A,{className:"h-4 w-4","aria-hidden":!0}),"Wake"]}),(0,i.jsx)("p",{className:"mt-1 text-lg font-semibold",children:t})]}),(0,i.jsxs)("div",{className:"rounded-xl border border-white/10 bg-[#0b1a33] p-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 text-white/80 text-sm",children:[(0,i.jsx)(O.A,{className:"h-4 w-4","aria-hidden":!0}),"Quiet hours"]}),(0,i.jsx)("p",{className:"mt-1 text-lg font-semibold",children:s?"On":"Off"})]})]})]})]})})]})})}}},e=>{e.O(0,[619,743,508,454,956,441,255,358],()=>e(e.s=2149)),_N_E=e.O()}]);