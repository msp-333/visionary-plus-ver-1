"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[386],{386:(e,t,r)=>{r.r(t),r.d(t,{default:()=>F});var s=r(5155),a=r(2115);let n=[200,160,125,100,80,63,50,40,32,25,20,16,12.5,10];function l(e){let{variant:t,pxPerMM:r,distanceCm:l,onResult:d,paused:c}=e,[x,u]=(0,a.useState)(8),[m,h]=(0,a.useState)(0),[b,p]=(0,a.useState)(0),[g,j]=(0,a.useState)([]),[w,v]=(0,a.useState)(!1),y=(0,a.useMemo)(()=>10*l*Math.tan(5/60*(Math.PI/180))*(n[x]/20),[x,l]),f="20/".concat(n[x]),N=Math.log10(n[x]/20),[k,S]=[window.innerWidth,window.innerHeight],C=Math.max(18,Math.min(r?Math.max(18,y*r):0,.75*Math.min(k,S)));(0,a.useEffect)(()=>{let e=e=>{if(c)return;let t={ArrowRight:0,ArrowDown:90,ArrowLeft:180,ArrowUp:270}[e.key];void 0!==t&&(e.preventDefault(),M(t===m))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[m,c]);let M=e=>{if(j(t=>[...t,"".concat(n[x],":").concat(e?"✓":"✗")]),e){let e=b+1;p(e),e>=2&&(u(e=>Math.min(e+1,n.length-1)),p(0))}else u(e=>Math.max(e-1,0)),p(0);h([0,90,180,270][Math.floor(4*Math.random())])};(0,a.useEffect)(()=>{let e=()=>E();return window.addEventListener("visionary:save-active-test",e),()=>window.removeEventListener("visionary:save-active-test",e)},[g,x,N]);let E=()=>d({id:"near"===t?"acuity-near":"acuity-distance",value:f,unit:"logMAR ".concat(N.toFixed(2)),notes:g.join(" • "),extra:{logMAR:Number(N.toFixed(2))},label:"near"===t?"Near Visual Acuity":"Distance Visual Acuity"}),D=(0,a.useRef)(null);return(0,s.jsxs)("section",{"aria-label":"Run Tumbling E",className:"relative",children:[(0,s.jsx)("div",{className:"sr-only","aria-live":"polite",children:"Current ".concat(f,", logMAR ").concat(N.toFixed(2))}),r?null:(0,s.jsx)("div",{className:"mb-3 rounded-xl border border-amber-500/30 bg-amber-500/10 p-3 text-xs text-amber-200",children:"Calibrate first for accurate letter size."}),(0,s.jsxs)("div",{className:"relative grid min-h-[60svh] place-items-center rounded-2xl border border-white/10 bg-black/30",onTouchStart:e=>{if(c)return;let t=e.changedTouches[0];D.current={x:t.clientX,y:t.clientY}},onTouchEnd:e=>{if(c||!D.current)return;let t=e.changedTouches[0],r=t.clientX-D.current.x,s=t.clientY-D.current.y,a=Math.abs(r),n=Math.abs(s);a<24&&n<24||(a>n?M(r>0&&0===m||r<0&&180===m):M(s>0&&90===m||s<0&&270===m),D.current=null)},children:[(0,s.jsx)(i,{sizePx:C,rotation:m,muted:!!c}),(0,s.jsxs)("div",{className:"pointer-events-none absolute inset-x-4 top-4",children:[(0,s.jsx)("div",{className:"h-1 w-full overflow-hidden rounded-full bg-white/10",children:(0,s.jsx)("div",{className:"h-full bg-[#6592E1] transition-[width]",style:{width:"".concat(x/(n.length-1)*100,"%")}})}),(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs text-slate-300",children:[(0,s.jsxs)("span",{children:["near"===t?"Near":"Distance"," — ",f," \xb7 logMAR ",N.toFixed(2)]}),c?(0,s.jsx)("span",{className:"rounded bg-white/10 px-2 py-[2px]",children:"Paused"}):null]})]}),!c&&(0,s.jsxs)("div",{className:"pointer-events-auto absolute inset-x-0 bottom-3 flex items-center justify-center gap-2 px-3",children:[(0,s.jsx)(o,{keyName:"←",onClick:()=>M(180===m),ariaLabel:"E left"}),(0,s.jsx)(o,{keyName:"↑",onClick:()=>M(270===m),ariaLabel:"E up"}),(0,s.jsx)(o,{keyName:"↓",onClick:()=>M(90===m),ariaLabel:"E down"}),(0,s.jsx)(o,{keyName:"→",onClick:()=>M(0===m),ariaLabel:"E right"})]})]}),(0,s.jsxs)("details",{className:"mt-3",children:[(0,s.jsx)("summary",{className:"cursor-pointer text-sm font-medium",children:"Show legend / instructions"}),(0,s.jsxs)("p",{className:"mt-1 text-sm text-slate-300",children:["Set distance to ",(0,s.jsx)("strong",{children:"near"===t?"40 cm":"200–300 cm"}),". Cover the non‑tested eye. Identify the E orientation by swiping or tapping a direction. The test adapts after each response (2‑down / 1‑up ladder)."]})]}),(0,s.jsx)("div",{className:"mt-4 hidden sm:block",children:(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:E,children:"Save result"})})]})}function i(e){let{sizePx:t,rotation:r,muted:a}=e,n=Math.round(t||80);return(0,s.jsxs)("svg",{width:n,height:n,viewBox:"0 0 100 100",style:{transform:"rotate(".concat(r,"deg)"),opacity:a?.25:1,transition:"opacity 160ms ease-out"},"aria-label":"Tumbling E stimulus",role:"img",children:[(0,s.jsx)("rect",{x:"10",y:"10",width:"20",height:"80",fill:"currentColor"}),(0,s.jsx)("rect",{x:"10",y:"10",width:"60",height:"20",fill:"currentColor"}),(0,s.jsx)("rect",{x:"10",y:"40",width:"50",height:"20",fill:"currentColor"}),(0,s.jsx)("rect",{x:"10",y:"70",width:"60",height:"20",fill:"currentColor"})]})}function o(e){let{keyName:t,onClick:r,ariaLabel:a}=e;return(0,s.jsx)("button",{onClick:r,"aria-label":a,className:"min-h-12 flex-1 rounded-xl border border-white/10 bg-white/10 py-3 text-lg font-semibold",style:{minHeight:48,minWidth:64},children:t})}var d=r(1155);function c(e){let{pxPerMM:t,distanceCm:r,onResult:n}=e,[l,i]=(0,a.useState)(50),[o,d]=(0,a.useState)(40),c=(0,a.useMemo)(()=>t?Math.max(40,10*r*Math.tan(5/60*(Math.PI/180))*(o/20)*t):100,[t,r,o]),x=(0,a.useMemo)(()=>Math.log10(1/(Math.max(1,Math.min(99,l))/100)),[l]);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsxs)("p",{className:"text-sm text-slate-300",children:["Keep distance at ",(0,s.jsxs)("b",{children:[r," cm"]}),". Lower the slider until the letter is just barely readable. Save that point. You can change letter size (recommend 20/40)."]}),t?null:(0,s.jsx)("div",{className:"mt-3 rounded-md border border-amber-500/30 bg-amber-500/10 p-2 text-xs text-amber-200",children:"Calibrate first for consistent sizing."}),(0,s.jsxs)("div",{className:"my-6 flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"rounded-xl border border-white/10 bg-white/5 p-8",children:(0,s.jsx)("span",{className:"block font-[900] leading-none tracking-tight",style:{fontSize:.7*c,opacity:l/100},children:"C"})}),(0,s.jsx)("input",{"aria-label":"Contrast",type:"range",min:1,max:99,value:l,onChange:e=>i(Number(e.target.value))}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,s.jsx)("label",{children:"Letter size"}),(0,s.jsx)("select",{className:"rounded-md border border-white/10 bg-white/5 p-2",value:o,onChange:e=>d(Number(e.target.value)),children:[40,32,25,20].map(e=>(0,s.jsxs)("option",{value:e,children:["20/",e]},e))}),(0,s.jsxs)("span",{className:"text-xs text-slate-400",children:["Result (logCS): ",(0,s.jsx)("b",{children:x.toFixed(2)})]})]}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>n({id:"contrast",value:x.toFixed(2),unit:"logCS",notes:"Method-of-adjustment @ 20/".concat(o," (contrast ").concat(l,"%)"),extra:{contrastPct:l,letter:"20/".concat(o)},label:"Contrast Sensitivity"}),children:"Save result"})]})]})}function x(e){let{onResult:t}=e,[r,n]=(0,a.useState)(new Set),[l,i]=(0,a.useState)("");return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Wear your near correction. At 30–40 cm, cover one eye and fixate the center dot. Tap any squares that look wavy or missing."}),(0,s.jsxs)("div",{className:"my-3 flex flex-col items-center gap-3",children:[(0,s.jsxs)("svg",{width:320,height:320,className:"rounded-md bg-white/5",children:[[...Array(21)].map((e,t)=>(0,s.jsx)("line",{x1:16*t,y1:0,x2:16*t,y2:320,stroke:"currentColor",strokeOpacity:.2},"v".concat(t))),[...Array(21)].map((e,t)=>(0,s.jsx)("line",{x1:0,y1:16*t,x2:320,y2:16*t,stroke:"currentColor",strokeOpacity:.2},"h".concat(t))),(0,s.jsx)("circle",{cx:160,cy:160,r:3,fill:"currentColor"}),[...r].map(e=>{let[t,r]=e.split(",").map(Number);return(0,s.jsx)("rect",{x:16*t,y:16*r,width:16,height:16,fill:"currentColor",fillOpacity:.12},e)}),[...Array(20)].map((e,t)=>[...Array(20)].map((e,r)=>(0,s.jsx)("rect",{x:16*t,y:16*r,width:16,height:16,fill:"transparent",onClick:()=>((e,t)=>{let r="".concat(e,",").concat(t);n(e=>{let t=new Set(e);return t.has(r)?t.delete(r):t.add(r),t})})(t,r)},"".concat(t,"-").concat(r))))]}),(0,s.jsx)("textarea",{className:"max-w-md rounded-md border border-white/10 bg-white/5 p-2 text-sm",rows:3,placeholder:"Describe where/what you noticed…",value:l,onChange:e=>i(e.target.value)}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"amsler",value:r.size?"".concat(r.size," cells flagged"):"No distortion flagged",notes:l,label:"Amsler Grid"}),children:"Save notes"})]})]})}function u(e){let{onResult:t}=e,[r,n]=(0,a.useState)(0),[l,i]=(0,a.useState)(1);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Cover one eye. Which spoke direction looks darkest or sharpest? Pick the angle and rate severity."}),(0,s.jsxs)("div",{className:"my-4 flex flex-col items-center gap-3",children:[(0,s.jsx)(m,{}),(0,s.jsxs)("div",{className:"flex w-full max-w-sm items-center gap-3 text-sm",children:[(0,s.jsx)("label",{className:"w-28",children:"Angle"}),(0,s.jsx)("input",{className:"w-full",type:"range",min:0,max:180,value:r,onChange:e=>n(Number(e.target.value))}),(0,s.jsxs)("span",{className:"w-10 text-right",children:[r,"\xb0"]})]}),(0,s.jsxs)("div",{className:"flex w-full max-w-sm items-center gap-3 text-sm",children:[(0,s.jsx)("label",{className:"w-28",children:"Severity"}),(0,s.jsx)("input",{className:"w-full",type:"range",min:1,max:5,value:l,onChange:e=>i(Number(e.target.value))}),(0,s.jsxs)("span",{className:"w-10 text-right",children:[l,"/5"]})]}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"astigmatism",value:"".concat(r,"\xb0"),notes:"perceived severity ".concat(l,"/5"),extra:{severity:l},label:"Astigmatism Dial"}),children:"Save"})]})]})}function m(){let e=[...Array(24)].map((e,t)=>{let r=t/24*Math.PI,a=130+120*Math.cos(r),n=130+120*Math.sin(r);return(0,s.jsx)("line",{x1:130,y1:130,x2:a,y2:n,stroke:"currentColor",strokeWidth:1.5},t)});return(0,s.jsxs)("svg",{width:260,height:260,className:"rounded-md bg-white/5 p-2",children:[(0,s.jsx)("circle",{cx:130,cy:130,r:120,fill:"none",stroke:"currentColor",strokeOpacity:.2}),e]})}function h(e){let{onResult:t}=e,[r,n]=(0,a.useState)("");return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"After acuity, cover one eye. Which side’s letters look darker/sharper — red, green, or the same?"}),(0,s.jsx)("div",{className:"my-4 overflow-hidden rounded-lg border border-white/10",children:(0,s.jsxs)("div",{className:"grid grid-cols-2",children:[(0,s.jsx)("div",{className:"flex items-center justify-center bg-[#CC0000] p-6 text-white",children:(0,s.jsx)("span",{className:"text-5xl font-black tracking-tight",children:"R"})}),(0,s.jsx)("div",{className:"flex items-center justify-center bg-[#008A00] p-6 text-white",children:(0,s.jsx)("span",{className:"text-5xl font-black tracking-tight",children:"G"})})]})}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[["red","green","same"].map(e=>(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5 "+(r===e?"ring-2 ring-[#6592E1]":""),onClick:()=>n(e),children:e},e)),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",disabled:!r,onClick:()=>r&&t({id:"duochrome",value:r,label:"Duochrome"}),children:"Save"})]})]})}function b(e){let{onResult:t}=e,r=(0,a.useMemo)(()=>(function(e){let t=[...e];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t})([0,24,48,72,96,120,144,168,192,216,240,264,288,312,336].map(e=>({h:e,l:55}))),[]),[n,l]=(0,a.useState)(r),i=(0,a.useMemo)(()=>(function(e){let t=0;for(let r=1;r<e.length-1;r++)!(e[r-1]<=e[r]&&e[r]<=e[r+1]||e[r-1]>=e[r]&&e[r]>=e[r+1])&&t++;return t})(n.map(e=>e.h)),[n]);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Drag the caps to form the smoothest hue gradient. Result is a roughness score for self‑tracking (lower is better)."}),(0,s.jsx)("div",{className:"mt-4 grid grid-cols-8 gap-2 sm:grid-cols-12",children:n.map((e,t)=>(0,s.jsx)("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",String(t))},onDragOver:e=>e.preventDefault(),onDrop:e=>((e,t)=>{let r=Number(e.dataTransfer.getData("text/plain"));if(Number.isNaN(r))return;let s=[...n],[a]=s.splice(r,1);s.splice(t,0,a),l(s)})(e,t),className:"aspect-square cursor-move rounded-md border border-white/10 shadow-sm transition hover:scale-[1.03]",title:"Hue ".concat(Math.round(e.h)),style:{background:"hsl(".concat(e.h," 85% ").concat(e.l,"%)")}},t))}),(0,s.jsxs)("div",{className:"mt-3 flex items-center gap-3 text-sm",children:[(0,s.jsxs)("span",{children:["Score: ",i]}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"color-arrangement",value:"".concat(i),unit:"crossings (lower is better)",label:"Color Arrangement"}),children:"Save"})]})]})}function p(e){let{onResult:t}=e,[r,n]=(0,a.useState)(!1),[l,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(g),[c,x]=(0,a.useState)(null),[u,m]=(0,a.useState)(0),[h,b]=(0,a.useState)(3),p=(0,a.useMemo)(()=>o.trim().split(/\s+/).length,[o]);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Tap start, read once at a comfortable pace, then tap stop. Enter errors (skips/misreads) and rate perceived strain."}),(0,s.jsxs)("div",{className:"mb-3 mt-2 flex flex-wrap items-center gap-2 text-sm",children:[r?(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1",onClick:()=>{l&&(x(Math.round(p/((Date.now()-l)/6e4))),n(!1))},children:"Stop"}):(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1",onClick:()=>{x(null),n(!0),i(Date.now())},children:"Start"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-xs text-slate-300",children:"Errors"}),(0,s.jsx)("input",{className:"w-20 rounded-md border border-white/10 bg-white/5 p-2 text-sm",type:"number",min:0,value:u,onChange:e=>m(Number(e.target.value))})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-xs text-slate-300",children:"Strain"}),(0,s.jsx)("input",{type:"range",min:0,max:10,value:h,onChange:e=>b(Number(e.target.value))}),(0,s.jsxs)("span",{className:"text-xs",children:[h,"/10"]})]}),c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{children:["Result: ",(0,s.jsxs)("b",{children:[c," WPM"]})]}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>c&&t({id:"reading-speed",value:String(c),unit:"WPM",notes:"errors ".concat(u,", strain ").concat(h,"/10"),extra:{errors:u,strain:h},label:"Reading Speed"}),children:"Save"})]}):null]}),(0,s.jsx)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-4 text-sm leading-relaxed",children:o})]})}let g="Staring at screens for long periods can reduce blink rate, which may lead to temporary dryness and blur. Short, frequent breaks and gentle focusing exercises can help maintain comfort during near work.";function j(e){let{onResult:t}=e,[r,n]=(0,a.useState)(["","",""]),l=Math.max(...r.filter(e=>"number"==typeof e&&!Number.isNaN(e)));return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsxs)("p",{className:"text-sm text-slate-300",children:["Move a small target slowly toward your nose until it doubles or blurs. Measure nose‑to‑target (cm). Repeat 3\xd7; record the ",(0,s.jsx)("em",{children:"worst"})," value."]}),(0,s.jsx)("div",{className:"mt-3 grid max-w-md grid-cols-3 gap-2 text-sm",children:r.map((e,t)=>(0,s.jsx)("input",{className:"rounded-md border border-white/10 bg-white/5 p-2 text-sm",type:"number",min:1,step:.5,placeholder:"Trial ".concat(t+1," (cm)"),value:e,onChange:e=>n(O(r,t,T(e.target.value)))},t))}),(0,s.jsxs)("div",{className:"mt-3 flex items-center gap-3 text-sm",children:[(0,s.jsxs)("span",{children:["Worst of 3: ",Number.isFinite(l)?"".concat(l," cm"):"—"]}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>Number.isFinite(l)&&t({id:"npc",value:"".concat(l),unit:"cm (worst of 3)",label:"NPC"}),disabled:!Number.isFinite(l),children:"Save"})]})]})}function w(e){let{onResult:t}=e,[r,n]=(0,a.useState)(""),l="number"==typeof r&&r>0?Math.round(100/r*10)/10:null;return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Move a small target toward the tested eye until it first blurs. Measure the closest clear distance (cm). Amplitude ≈ 100 / cm."}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{className:"w-40 rounded-md border border-white/10 bg-white/5 p-2 text-sm",type:"number",min:2,step:.5,placeholder:"Closest clear (cm)",value:r,onChange:e=>n(T(e.target.value))}),(0,s.jsxs)("span",{children:["Amplitude: ",l?(0,s.jsxs)("b",{children:[l," D"]}):"—"]}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>l&&t({id:"accommodation",value:String(l),unit:"D",notes:"closest clear ".concat(r," cm"),label:"Accommodation Amplitude"}),disabled:!l,children:"Save"})]})]})}function v(e){let{onResult:t}=e,[r,n]=(0,a.useState)(60),[l,i]=(0,a.useState)(40);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Adjust each slider to the lowest intensity where the letter is still readable."}),(0,s.jsxs)("div",{className:"my-4 grid gap-6 sm:grid-cols-2",children:[(0,s.jsx)(y,{label:"No glare",value:r,onChange:n,glare:0}),(0,s.jsx)(y,{label:"With glare",value:l,onChange:i,glare:1})]}),(0,s.jsxs)("div",{className:"text-sm",children:["Impact Δ: ",(0,s.jsx)("b",{children:(r-l).toFixed(0)})]}),(0,s.jsx)("button",{className:"mt-2 rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"glare",value:"".concat((r-l).toFixed(0)),unit:"Δ (higher = more impact)",notes:"no glare ".concat(r," vs glare ").concat(l),label:"Glare/Photophobia"}),children:"Save"})]})}function y(e){let{label:t,value:r,onChange:a,glare:n}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,s.jsx)("div",{className:"text-xs text-slate-300",children:t}),(0,s.jsx)("div",{className:"flex h-56 w-56 items-center justify-center rounded-full",style:{background:1===n?"radial-gradient(circle, rgba(255,255,255,".concat(r/100,") 0%, rgba(255,255,255,").concat(r/200,") 40%, rgba(0,0,0,1) 80%)"):"radial-gradient(circle, rgba(0,0,0,1) 80%, rgba(0,0,0,1) 100%)"},children:(0,s.jsx)("span",{className:"text-6xl font-black text-white drop-shadow",children:"A"})}),(0,s.jsx)("input",{"aria-label":"".concat(t," intensity"),type:"range",min:0,max:100,value:r,onChange:e=>a(Number(e.target.value))})]})}function f(e){let{onResult:t}=e,[r,n]=(0,a.useState)("");return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Extend arms, make a small triangular aperture with your hands, and center the on‑screen ✦ star. Close one eye at a time — which eye keeps the star centered? That’s your dominant eye."}),(0,s.jsx)("div",{className:"my-5 flex items-center justify-center",children:(0,s.jsx)("div",{className:"grid h-40 w-40 place-items-center rounded-full border border-dashed border-white/20",children:(0,s.jsx)("span",{className:"text-4xl",children:"✦"})})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5 "+("OD"===r?"ring-2 ring-[#6592E1]":""),onClick:()=>n("OD"),children:"Right (OD)"}),(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5 "+("OS"===r?"ring-2 ring-[#6592E1]":""),onClick:()=>n("OS"),children:"Left (OS)"}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",disabled:!r,onClick:()=>r&&t({id:"eye-dominance",value:r,label:"Eye Dominance"}),children:"Save"})]})]})}function N(e){let{onResult:t}=e,[r,n]=(0,a.useState)("");return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"With red‑green glasses on, report how many dots and which colors you see."}),(0,s.jsx)("div",{className:"my-4 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,s.jsx)(k,{color:"#ff2a2a"}),(0,s.jsx)(k,{color:"#2aff2a"}),(0,s.jsx)(k,{color:"#2aff2a"}),(0,s.jsx)(k,{color:"#ffffff"})]})}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[["2 red","3 green","4 mixed","5 double"].map(e=>(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5 "+(r===e?"ring-2 ring-[#6592E1]":""),onClick:()=>n(e),children:e},e)),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",disabled:!r,onClick:()=>r&&t({id:"worth-4-dot",value:r,label:"Worth 4‑Dot"}),children:"Save"})]})]})}function k(e){let{color:t}=e;return(0,s.jsx)("div",{className:"h-10 w-10 rounded-full border border-white/20",style:{background:t}})}function S(e){let{pxPerMM:t,distanceCm:r,onResult:n}=e,[l,i]=(0,a.useState)(0),[o,d]=(0,a.useState)(null),c=[600,300,200,150,100,60],x=e=>t?Math.max(1,Math.round(10*r*Math.tan(e/3600*(Math.PI/180))*t)):2,u=e=>{if(e){let e=l+1;e>=c.length?d(c[l]):i(e)}else d(c[l]||c[c.length-1])};return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Wear red‑cyan glasses (red left). Identify which circle appears “in front”. Levels decrease disparity (arcsec)."}),t?null:(0,s.jsx)("div",{className:"mt-3 rounded-md border border-amber-500/30 bg-amber-500/10 p-2 text-xs text-amber-200",children:"Calibrate first for disparity accuracy."}),(0,s.jsxs)("div",{className:"my-4 grid place-items-center gap-3",children:[(0,s.jsx)(C,{pxOffset:x(c[l]),onPick:u}),(0,s.jsxs)("div",{className:"text-xs text-slate-400",children:["Level: ~",c[l],'" (',x(c[l])," px)"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5",onClick:()=>u(!0),children:"I picked correctly"}),(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5",onClick:()=>u(!1),children:"I picked wrong / unsure"}),o?(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>o&&n({id:"stereopsis",value:"".concat(o),unit:"arcsec (approx)",notes:"min disparity recognized: ".concat(o,'"'),extra:{arcsec:o},label:"Stereopsis"}),children:"Save"}):null]})]})]})}function C(e){let{pxOffset:t,onPick:r}=e,a=Math.floor(3*Math.random());return(0,s.jsx)("div",{className:"flex items-center justify-center gap-10",children:[0,1,2].map(e=>(0,s.jsx)("div",{className:"cursor-pointer rounded-md p-2 hover:bg-white/10",onClick:()=>r(e===a),children:(0,s.jsxs)("svg",{width:88,height:48,children:[(0,s.jsx)("circle",{cx:24+(e===a?-t:0),cy:24,r:24,fill:"rgba(0,255,255,0.7)"}),(0,s.jsx)("circle",{cx:24+(e===a?t:0),cy:24,r:24,fill:"rgba(255,0,0,0.7)"}),(0,s.jsx)("circle",{cx:24,cy:24,r:24,fill:"none",stroke:"currentColor",strokeOpacity:.25})]})},e))})}function M(e){let{onResult:t}=e,[r,n]=(0,a.useState)(!1),[l,i]=(0,a.useState)(0),[o,c]=(0,a.useState)(0),x=(0,a.useMemo)(()=>{let e=[];for(let t=0;t<360;t+=45){let r=t*Math.PI/180;e.push({x:120*Math.cos(r),y:120*Math.sin(r)})}for(let t=0;t<360;t+=60){let r=t*Math.PI/180;e.push({x:80*Math.cos(r),y:80*Math.sin(r)})}return e.push({x:40,y:0},{x:-40,y:0},{x:0,y:40},{x:0,y:-40}),e.slice(0,24)},[]),[u,m]=(0,a.useState)(0);(0,a.useEffect)(()=>{let e;return r&&(e=window.setTimeout(()=>{m(e=>(e+1)%24),i(e=>e+1)},900)),()=>clearTimeout(e)},[r,l,24]);let h=()=>{r&&(c(e=>e+1),m(e=>(e+1)%24),i(e=>e+1))};return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsxs)("p",{className:"text-sm text-slate-300",children:["Fixate the center +. Press ",(0,s.jsx)("b",{children:"Space"})," or tap “Saw it” whenever you notice a flash in the periphery."]}),(0,s.jsxs)("div",{className:"my-4 grid place-items-center gap-3",children:[(0,s.jsxs)("div",{className:"relative h-64 w-64 rounded-md border border-white/10",children:[(0,s.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-xl",children:"+"}),r?(0,s.jsx)("div",{className:"absolute left-1/2 top-1/2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full",style:{transform:"translate(".concat(x[u].x,"px, ").concat(x[u].y,"px)"),background:"white",boxShadow:"0 0 0 3px "+d.qt.ceil}}):null]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[r?(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5",onClick:()=>n(!1),children:"Stop"}):(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5",onClick:()=>{n(!0),i(0),c(0)},children:"Start"}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:h,disabled:!r,children:"Saw it"}),(0,s.jsxs)("span",{className:"text-xs text-slate-400",children:["Hits: ",o," / ",l]}),!r&&l>0?(0,s.jsx)("button",{className:"rounded-md border border-white/10 bg-white/5 px-3 py-1.5",onClick:()=>t({id:"visual-field",value:"".concat(Math.round(o/Math.max(1,l)*100)),unit:"% seen (screening)",notes:"".concat(o,"/").concat(l," seen"),label:"Visual Field (screening)"}),children:"Save"}):null]})]}),(0,s.jsx)(E,{active:r,onSpace:h})]})}function E(e){let{active:t,onSpace:r}=e;return(0,a.useEffect)(()=>{if(!t)return;let e=e=>{"Space"===e.code&&(e.preventDefault(),r())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,r]),null}function D(e){let{onResult:t}=e,[r,n]=(0,a.useState)({}),l=Object.values(r).filter(e=>""!==e).length,i=Object.values(r).reduce((e,t)=>"number"==typeof t?e+t:e,0),o=l?25*i/l:0;return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Rate frequency over the last week (0=none, 4=all the time)."}),(0,s.jsx)("table",{className:"mt-2 w-full text-sm",children:(0,s.jsx)("tbody",{children:["Eyes that are sensitive to light?","Eyes that feel gritty?","Painful or sore eyes?","Blurred vision?","Poor vision?","Reading?","Driving at night?","Working with a computer or bank machine (ATM)?","Watching TV?","Windy conditions?","Places or areas with low humidity (very dry)?","Areas that are air conditioned?"].map((e,t)=>{var a;return(0,s.jsxs)("tr",{className:"border-t border-white/10",children:[(0,s.jsx)("td",{className:"py-2 pr-2",children:e}),(0,s.jsx)("td",{className:"w-48",children:(0,s.jsxs)("select",{className:"w-full rounded-md border border-white/10 bg-white/5 p-2 text-sm",value:null!=(a=r[t])?a:"",onChange:e=>n(r=>({...r,[t]:""===e.target.value?"":Number(e.target.value)})),children:[(0,s.jsx)("option",{value:"",children:"—"}),[0,1,2,3,4].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})})]},t)})})}),(0,s.jsxs)("div",{className:"mt-2 text-sm",children:["Score: ",(0,s.jsx)("b",{children:o.toFixed(1)})," / 100"]}),(0,s.jsx)("button",{className:"mt-2 rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"osdi",value:o.toFixed(1),unit:"0–100",notes:"".concat(l,"/12 answered"),label:"OSDI"}),disabled:!l,children:"Save"})]})}function R(e){let{onResult:t}=e,r=["Do your eyes feel tired when reading or doing close work?","Do your eyes feel uncomfortable when reading or doing close work?","Do you have headaches when reading or doing close work?","Do you feel sleepy when reading or doing close work?","Do you lose concentration when reading or doing close work?","Do you have trouble remembering what you have read?","Do you read slowly?","Do your eyes ever hurt when reading?","Do your eyes ever feel sore when reading?","Do you feel a “pulling” feeling around your eyes when reading?","Do you notice the words move, jump, swim, or appear to float on the page?","Do you experience double vision when reading or doing close work?","Do you have to re-read the same line of words when reading?","Do you get headaches when reading or doing close work?","Do you feel that you read slowly?"],[n,l]=(0,a.useState)(Array(r.length).fill(0)),i=n.reduce((e,t)=>e+t,0);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Rate frequency (0=never, 1=rarely, 2=sometimes, 3=frequently, 4=always)."}),(0,s.jsx)("div",{className:"mt-2 grid gap-2",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-[1fr,9rem] items-center gap-2 border-t border-white/10 pt-2 text-sm",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("select",{className:"rounded-md border border-white/10 bg-white/5 p-2 text-sm",value:n[t],onChange:e=>l(r=>O(r,t,Number(e.target.value))),children:[0,1,2,3,4].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]},t))}),(0,s.jsxs)("div",{className:"mt-2 text-sm",children:["Score: ",(0,s.jsx)("b",{children:i})]}),(0,s.jsx)("button",{className:"mt-2 rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"ciss",value:String(i),unit:"raw score",label:"CISS"}),children:"Save"})]})}function A(e){let{onResult:t}=e,[r,n]=(0,a.useState)(0),l=["Dryness","Burning","Headache","Blur after screen","Double vision","Neck/shoulder pain","Light sensitivity"],[i,o]=(0,a.useState)(Array(l.length).fill(0)),d=i.reduce((e,t)=>e+t,0);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Rate last‑week symptom frequency (0–4). Log how many days you did the 20‑20‑20 rule."}),(0,s.jsxs)("div",{className:"grid gap-2",children:[l.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-[1fr,9rem] items-center gap-2 border-t border-white/10 pt-2 text-sm",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("select",{className:"rounded-md border border-white/10 bg-white/5 p-2 text-sm",value:i[t],onChange:e=>o(r=>O(r,t,Number(e.target.value))),children:[0,1,2,3,4].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]},t)),(0,s.jsxs)("div",{className:"grid grid-cols-[1fr,9rem] items-center gap-2 border-t border-white/10 pt-2 text-sm",children:[(0,s.jsx)("span",{children:"20‑20‑20 days (out of 7)"}),(0,s.jsx)("input",{className:"rounded-md border border-white/10 bg-white/5 p-2 text-sm",type:"number",min:0,max:7,value:r,onChange:e=>n(Number(e.target.value))})]})]}),(0,s.jsxs)("div",{className:"mt-2 text-sm",children:["Score: ",(0,s.jsx)("b",{children:d})]}),(0,s.jsx)("button",{className:"mt-2 rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"cvs",value:String(d),unit:"symptom score",notes:"20‑20‑20 adherence ".concat(r,"/7 days"),label:"CVS / 20‑20‑20"}),children:"Save"})]})}function P(e){let{onResult:t}=e,r=["Halos around lights","Glare from headlights","Difficulty reading street signs","Washed out contrast","Need more light than others","Slower dark adaptation"],[n,l]=(0,a.useState)(Array(r.length).fill(0)),i=n.reduce((e,t)=>e+t,0);return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Rate how often you notice each (0–4). Track the trend over time."}),(0,s.jsx)("div",{className:"grid gap-2",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"grid grid-cols-[1fr,9rem] items-center gap-2 border-t border-white/10 pt-2 text-sm",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("select",{className:"rounded-md border border-white/10 bg-white/5 p-2 text-sm",value:n[t],onChange:e=>l(r=>O(r,t,Number(e.target.value))),children:[0,1,2,3,4].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]},t))}),(0,s.jsxs)("div",{className:"mt-2 text-sm",children:["Score: ",(0,s.jsx)("b",{children:i})]}),(0,s.jsx)("button",{className:"mt-2 rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>t({id:"night-vision",value:String(i),unit:"checklist score",label:"Night/Low‑Light"}),children:"Save"})]})}function L(e){let{pxPerMM:t,onResult:r}=e,[n,l]=(0,a.useState)("");return(0,s.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Stand at a mirror. Hold a millimeter ruler under your eyes and measure center‑to‑center pupil distance. Or place a clear card against the screen ruler (calibrated)."}),t?null:(0,s.jsx)("div",{className:"mt-3 rounded-md border border-amber-500/30 bg-amber-500/10 p-2 text-xs text-amber-200",children:"Calibrate to show accurate on‑screen mm scale."}),(0,s.jsxs)("div",{className:"my-3",children:[(0,s.jsx)("div",{className:"mb-2 text-xs text-slate-300",children:"On‑screen mm scale"}),(0,s.jsxs)("div",{className:"relative h-12 rounded-md border border-white/10 bg-white/5",children:[t?[...Array(151)].map((e,r)=>(0,s.jsx)("div",{className:"absolute bottom-0",style:{left:"".concat(r*t,"px"),width:1,height:r%10==0?"60%":"35%",background:"currentColor",opacity:.5},title:"".concat(r," mm")},r)):null,t?(0,s.jsx)("div",{className:"absolute left-2 top-1 text-[10px] opacity-60",children:"0 mm"}):null,t?(0,s.jsx)("div",{className:"absolute right-2 top-1 text-[10px] opacity-60",children:"150 mm"}):null]})]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{className:"w-40 rounded-md border border-white/10 bg-white/5 p-2 text-sm",type:"number",min:45,max:80,placeholder:"Enter PD (mm)",value:n,onChange:e=>l(T(e.target.value))}),(0,s.jsx)("button",{className:"rounded-xl bg-[#6592E1] px-4 py-2 text-sm text-white",onClick:()=>"number"==typeof n&&r({id:"pd-ruler",value:String(n),unit:"mm",label:"PD"}),disabled:"number"!=typeof n,children:"Save"})]})]})}function O(e,t,r){let s=[...e];return s[t]=r,s}function T(e){let t=Number(e);return Number.isFinite(t)?t:""}function F(e){let{id:t,pxPerMM:r,distanceCm:a,eye:n,onResult:i,paused:o}=e;switch(t){case"acuity-near":return(0,s.jsx)(l,{variant:"near",pxPerMM:r,distanceCm:a,onResult:i,paused:o});case"acuity-distance":return(0,s.jsx)(l,{variant:"distance",pxPerMM:r,distanceCm:a,onResult:i,paused:o});case"contrast":return(0,s.jsx)(c,{pxPerMM:r,distanceCm:a,onResult:i});case"amsler":return(0,s.jsx)(x,{onResult:i});case"astigmatism":return(0,s.jsx)(u,{onResult:i});case"duochrome":return(0,s.jsx)(h,{onResult:i});case"color-arrangement":return(0,s.jsx)(b,{onResult:i});case"reading-speed":return(0,s.jsx)(p,{onResult:i});case"npc":return(0,s.jsx)(j,{onResult:i});case"accommodation":return(0,s.jsx)(w,{onResult:i});case"glare":return(0,s.jsx)(v,{onResult:i});case"eye-dominance":return(0,s.jsx)(f,{onResult:i});case"worth-4-dot":return(0,s.jsx)(N,{onResult:i});case"stereopsis":return(0,s.jsx)(S,{pxPerMM:r,distanceCm:a,onResult:i});case"visual-field":return(0,s.jsx)(M,{onResult:i});case"osdi":return(0,s.jsx)(D,{onResult:i});case"ciss":return(0,s.jsx)(R,{onResult:i});case"cvs":return(0,s.jsx)(A,{onResult:i});case"night-vision":return(0,s.jsx)(P,{onResult:i});case"pd-ruler":return(0,s.jsx)(L,{pxPerMM:r,onResult:i});default:return null}}}}]);